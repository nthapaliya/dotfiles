#!/usr/bin/env ruby

require 'open3'

DOTFILES_DIR = File.expand_path('~/Projects/dotfiles/')
BREWFILE = 'macos/.Brewfile'.freeze

def lines
  command = "cd #{DOTFILES_DIR}; git diff --word-diff=porcelain -- #{BREWFILE}"
  raw_diff, status = Open3.capture2(command)
  abort unless status.success?

  raw_diff
    .chomp
    .delete("\n")
    .split('~')
    .map(&:strip)
    .select { |line| line.start_with?('+', '-') }
end

def parse_diffed_lines
  additions = lines
              .select { |line| line.start_with?('+') }
              .map { |line| line.delete('+') }
  subtractions = lines
                 .select { |line| line.start_with?('-') }
                 .map { |line| line.delete('-') }

  [additions, subtractions]
end

additions, subtractions = parse_diffed_lines

puts 'True Additions'
puts additions - subtractions
puts

puts 'True subtractions'
puts subtractions - additions
puts

puts 'Rearranges'
puts additions & subtractions
