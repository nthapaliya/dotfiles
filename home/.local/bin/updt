#! /bin/bash

brew_cache_dir=~/Library/Caches/Homebrew
[[ ! -d $brew_cache_dir ]] && mkdir -p $brew_cache_dir

hfile=$brew_cache_dir/.updated

if [[ -f $hfile ]] ; then
  time_diff=$(( $( date +%s ) - $( date -r "$hfile" +%s ) ))
else
  time_diff=999999999
fi

if [[ $time_diff -lt $(( 4 * 60 * 60 )) ]]; then
  exit
fi

commands=( \
  'brew update' \
  'brew upgrade' \
  # 'brew cleanup' \
  'brew cask outdated' \
  'brew bundle dump --force --file=~/.config/brew/Brewfile' \
  # 'brew cask upgrade' \
  'mas outdated' \
  # 'mas upgrade'
  'vim +PlugUpgrade +PlugUpdate' \
  )

for command in "${commands[@]}"; do
  echo "$command" && $command
done

touch $hfile
